# 五子棋 AI 项目 (Gomoku)

> **最后更新**: 2026年1月11日  
> **作者**: 人工编写 + AI 辅助增强

---

## 📋 项目简介

这是一个功能完整的五子棋程序，使用标准 C 语言 (C99) 编写，实现了标准五子棋规则（包括黑棋禁手：三三、四四、长连）。

本项目包含两个可用版本的 AI，满足不同需求。

---

## 📁 目录结构

```
Final/
├── README.md           # 本文件
├── Minimax/            # ✅ 推荐版本 - Minimax + Alpha-Beta
│   ├── gomoku.exe      # 可执行文件 (~450KB)
│   ├── Makefile
│   └── src/            # C 源代码
│
└── NN_Hybrid/          # 神经网络 + Minimax 混合版
    ├── gomoku.exe      # 可执行文件 (~15MB)
    ├── Makefile
    ├── src/            # C 源代码
    └── ai_training/    # Python 训练脚本和模型
```

---

## 🎮 版本说明

### 1. Minimax 版 (推荐)

| 项目 | 说明 |
|------|------|
| **路径** | `Final/Minimax/` |
| **算法** | Minimax + Alpha-Beta 剪枝 + 置换表 + 迭代加深 |
| **搜索深度** | 2-12 层（15秒时间限制内自动调整）|
| **文件大小** | ~450 KB |
| **特点** | 轻量、快速、棋力稳定 |

**使用方法**：
```bash
cd Minimax
mingw32-make        # 编译（如需重新编译）
.\gomoku.exe        # 运行
```

### 2. NN_Hybrid 版 (神经网络混合)

| 项目 | 说明 |
|------|------|
| **路径** | `Final/NN_Hybrid/` |
| **算法** | 神经网络评估 + Minimax 搜索 |
| **训练框架** | PyTorch (Python) |
| **推理引擎** | 纯 C 实现（权重硬编码到 model_weights.h）|
| **文件大小** | ~15 MB（包含神经网络权重）|
| **特点** | 学习型 AI，需要训练 |

**使用方法**：
```bash
cd NN_Hybrid
mingw32-make        # 编译
.\gomoku.exe        # 运行
```

**重新训练模型**（可选）：
```bash
cd NN_Hybrid/ai_training
python train.py                 # 训练模型
python export_weights.py        # 导出权重到 C 头文件
cd ..
mingw32-make clean && mingw32-make  # 重新编译
```

---

## 🕹️ 游戏模式

程序启动后可选择：

| 模式 | 说明 |
|------|------|
| **1. PvP** | 双人对战，轮流落子 |
| **2. PvE (执黑)** | 玩家先手（黑棋），AI 后手 |
| **3. PvE (执白)** | AI 先手（黑棋），玩家后手 |
| **4. EvE** | AI 自我对战，观赏模式 |

**落子方式**：输入坐标如 `H8`、`A1`、`O15` 等。

---

## 📝 更新日志

### 2026-01-11 (AI 辅助增强)
- **🐛 修复**: 置换表 Zobrist Hash 未包含回合信息导致的分数污染 bug
- **⚡ 增强**: 棋型识别支持跳棋型（跳三、跳四）
- **⚡ 增强**: 组合威胁识别（双活三、冲四+活三、双冲四）
- **⚡ 增强**: 防守权重优化（提升至 1.1-1.5）
- **🧹 清理**: 删除调试文件和重复的 gomoku.exe

### 2026-01-08 (人工编写)
- 完成 Minimax 版本核心算法
- 完成 NN_Hybrid 版本训练流程
- 实现禁手规则检测

### 更早 (人工编写)
- 项目初始化
- 棋盘、游戏逻辑、规则模块

---

## 🤖 代码贡献说明

| 模块 | 贡献者 |
|------|--------|
| 棋盘 (`board.c/h`) | 人工编写 |
| 游戏逻辑 (`game.c/h`) | 人工编写 |
| 禁手规则 (`rules.c/h`) | 人工编写 |
| AI 核心 (`ai.c/ai_engine.c`) | 人工编写 + **AI 辅助调试增强** |
| 神经网络训练 (`train.py`) | 人工编写 |
| Bug 修复 & 棋型优化 | **AI 辅助** (2026-01-11) |

---

## 📊 技术细节

### Minimax 版 AI 特性
- **搜索算法**: Negamax (Minimax 变体)
- **剪枝**: Alpha-Beta 剪枝
- **置换表**: Zobrist Hashing，约 100 万条目
- **迭代加深**: 深度 2→4→6→...→12
- **时间控制**: 15 秒超时自动返回最佳着法
- **着法排序**: 历史启发 + 置换表最佳着法优先
- **棋型评估**:
  - 连五: 10,000,000 分
  - 活四: 1,000,000 分
  - 冲四: 100,000 分
  - 活三: 50,000 分（含跳三）
  - 眠三: 5,000 分
  - 组合威胁加成（双活三、冲四+活三等）

### NN_Hybrid 版 AI 特性
- **神经网络**: 卷积神经网络 (CNN)
- **训练框架**: PyTorch
- **权重导出**: Python → C 头文件
- **推理**: 纯 C 实现，无外部依赖

---

## 🔧 编译环境

- **操作系统**: Windows (MinGW) / Linux (GCC)
- **编译器**: GCC (支持 C99)
- **构建工具**: GNU Make (`mingw32-make` on Windows)
- **Python** (仅 NN_Hybrid 训练需要): 3.8+, PyTorch

---

## 📜 许可证

本项目仅用于学习和课程作业，请勿用于商业用途。

